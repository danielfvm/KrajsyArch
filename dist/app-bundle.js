/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/krajsy.ts":
/*!***********************!*\
  !*** ./src/krajsy.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.assemble = exports.CPU = exports.Instructions = exports.Registers = exports.RAM = exports.ROM = void 0;
const Empty = (length) => Array.from(Array(length).keys()).map(() => 0);
class ROM {
    constructor(data = null) {
        var _a;
        this.data = Empty(256);
        this.memcpy(data, 0, (_a = data === null || data === void 0 ? void 0 : data.length) !== null && _a !== void 0 ? _a : 0);
    }
    memcpy(src, dest, size) {
        for (let i = dest; i < dest + size; ++i)
            this.data[i] = src[i];
    }
    get(idx) {
        if (idx < 0 || idx > 255)
            throw "Program tried to access memory out of bounds!";
        return this.data[idx];
    }
    dump() {
        return this.data.map((x, i) => x.toString(16).padStart(2, '0') + (((i + 1) % 16) ? ' ' : '\n')).join('');
    }
}
exports.ROM = ROM;
class RAM extends ROM {
    set(idx, data) {
        if (idx < 0 || idx > 255)
            throw "Program tried to access memory out of bounds!";
        this.data[idx] = data;
    }
    reset() {
        this.data = Empty(256);
    }
}
exports.RAM = RAM;
var Registers;
(function (Registers) {
    Registers[Registers["A"] = 0] = "A";
    Registers[Registers["B"] = 1] = "B";
    Registers[Registers["PC"] = 2] = "PC";
})(Registers || (exports.Registers = Registers = {}));
var Instructions;
(function (Instructions) {
    Instructions[Instructions["INV"] = 0] = "INV";
    Instructions[Instructions["ADD"] = 1] = "ADD";
    Instructions[Instructions["SUB"] = 2] = "SUB";
    Instructions[Instructions["OR"] = 3] = "OR";
    Instructions[Instructions["AND"] = 4] = "AND";
    Instructions[Instructions["XOR"] = 5] = "XOR";
    Instructions[Instructions["GET"] = 6] = "GET";
    Instructions[Instructions["SET"] = 7] = "SET";
    Instructions[Instructions["LD"] = 8] = "LD";
    Instructions[Instructions["SWP"] = 9] = "SWP";
    // ...
    Instructions[Instructions["JZ"] = 28] = "JZ";
    Instructions[Instructions["JNZ"] = 29] = "JNZ";
    Instructions[Instructions["JG"] = 30] = "JG";
    Instructions[Instructions["JL"] = 31] = "JL";
})(Instructions || (exports.Instructions = Instructions = {}));
class CPU {
    constructor(rom, ram) {
        this.rom = rom;
        this.ram = ram;
        this.A = this.B = this.PC = 0;
    }
    step() {
        var _a, _b;
        // Read instruction code from rom
        const opcode = this.rom.get(this.PC);
        const op0 = (opcode >> 7) & 0b1; // Selection between A/B register as X
        const op1 = (opcode >> 5) & 0b11; // Selection between A/B/RAM/ROM as Y
        const ins = opcode & 0b11111; // Instruction to execute between X and Y
        const X = op0 ? this.B : this.A;
        const Y = op1 == 0b00 ? this.A :
            op1 == 0b01 ? this.B :
                op1 == 0b10 ? this.ram.get(this.rom.get(++this.PC)) :
                    op1 == 0b11 ? this.rom.get(++this.PC) : 0;
        let X0 = null;
        let Y0 = null;
        switch (ins) {
            case Instructions.INV:
                X0 = ~X;
                break;
            case Instructions.ADD:
                X0 = X + Y;
                break;
            case Instructions.SUB:
                X0 = X - Y;
                break;
            case Instructions.OR:
                X0 = X | Y;
                break;
            case Instructions.AND:
                X0 = X & Y;
                break;
            case Instructions.XOR:
                X0 = X ^ Y;
                break;
            case Instructions.GET:
                X0 = this.ram.get(Y);
                break;
            case Instructions.SET:
                this.ram.set(Y, X);
                break;
            case Instructions.LD:
                X0 = Y;
                break;
            case Instructions.SWP:
                {
                    [this.A, this.B] = [this.B, this.A];
                }
                break;
            case Instructions.JZ:
                {
                    if (X == 0)
                        this.PC = Y - 1;
                }
                break;
            case Instructions.JNZ:
                {
                    if (X != 0)
                        this.PC = Y - 1;
                }
                break;
            case Instructions.JG:
                {
                    if (X > 0)
                        this.PC = Y - 1;
                }
                break;
            case Instructions.JL:
                {
                    if (X < 0)
                        this.PC = Y - 1;
                }
                break;
        }
        // Update registers, make sure they are not overflowing
        this.PC = (this.PC + 1) & 0xFF;
        this.A = ((_a = (op0 ? Y0 : X0)) !== null && _a !== void 0 ? _a : this.A) & 0xFF;
        this.B = ((_b = (op0 ? X0 : Y0)) !== null && _b !== void 0 ? _b : this.B) & 0xFF;
    }
    reset() {
        this.ram.reset();
        this.A = this.B = this.PC = 0;
    }
    dump() {
        console.log(`A: ${this.A.toString(16)}`);
        console.log(`B: ${this.B.toString(16)}`);
        console.log(`PC: ${this.PC.toString(16)}`);
        console.log(`RAM:\n${this.ram.dump()}`);
        console.log(`ROM:\n${this.rom.dump()}`);
    }
}
exports.CPU = CPU;
const assemble = (code) => {
    const lines = code.split('\n').filter((x) => x.trim().length != 0 && !x.startsWith(';'));
    const labels = {};
    const bytes = [];
    let layout = "";
    const fetchOperant = (token) => {
        if (token == undefined)
            return [0, -1];
        switch (token[0]) {
            case 'A':
                return [0b00, -1];
            case 'B':
                return [0b01, -1];
            case '*':
                return [0b10, parseInt(token.substring(1), 16)];
            case '#':
                return [0b11, parseInt(token.substring(1), 16)];
            default:
                if (labels[token] != undefined) {
                    return [0b11, labels[token]];
                }
                throw "Invalid operant value!";
        }
    };
    lines.forEach((line) => {
        const tokens = line.split(';')[0].split(' ');
        const opcode = tokens.shift().toUpperCase();
        const operants = tokens.join('').toUpperCase().split(',').filter(x => x.trim().length > 0);
        if (opcode.endsWith(':')) {
            labels[opcode.substring(0, opcode.length - 1)] = bytes.length;
            return;
        }
        const ins = Instructions[opcode];
        if (ins == undefined)
            throw "Opcode does not exist!";
        const x = operants.length > 0 && fetchOperant(operants[0]);
        const y = operants.length > 1 && fetchOperant(operants[1]);
        if (x[0] > 0b01)
            throw "First operant can only be A or B!";
        const code = (x[0] << 7) | (y[0] << 5) | ins;
        let row = code.toString(16).padStart(2, '0') + ' ';
        let addr = bytes.length;
        bytes.push(code);
        if (y[1] >= 0) {
            bytes.push(y[1]);
            row += y[1].toString(16).padStart(2, '0') + ' ';
        }
        layout += (addr.toString() + ':').padStart(4, '0').padEnd(8, ' ') + row.padEnd(10, ' ') + `; ${line}\n`;
    });
    return {
        bytes: bytes,
        layout: layout,
    };
};
exports.assemble = assemble;


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
var exports = __webpack_exports__;
/*!********************!*\
  !*** ./src/app.ts ***!
  \********************/

Object.defineProperty(exports, "__esModule", ({ value: true }));
const krajsy_1 = __webpack_require__(/*! ./krajsy */ "./src/krajsy.ts");
window.onload = () => {
    const input = document.getElementById("input");
    const output = document.getElementById("output");
    const ram = document.getElementById("ram");
    const regA = document.getElementById("regA");
    const regB = document.getElementById("regB");
    const regPC = document.getElementById("regPC");
    const reset = document.getElementById("reset");
    const step = document.getElementById("step");
    const compile = document.getElementById("compile");
    const run = document.getElementById("run");
    const share = document.getElementById("share");
    let result = null;
    let cpu = null;
    let inv = null;
    if (window.location.search.length > 0) {
        try {
            input.value = atob(window.location.search.replace("?share=", ""));
        }
        catch (e) { }
    }
    reset.onclick = () => {
        cpu === null || cpu === void 0 ? void 0 : cpu.reset();
        updateDisplay();
    };
    step.onclick = () => {
        if (result.layout.split('\n').filter((x) => parseInt(x) == cpu.PC).length == 0) {
            if (inv != null)
                run.onclick(null);
            alert("PC hit end of ROM");
        }
        cpu === null || cpu === void 0 ? void 0 : cpu.step();
        updateDisplay();
    };
    compile.onclick = () => {
        try {
            result = (0, krajsy_1.assemble)(input.value);
            output.innerHTML = result.layout;
            cpu = new krajsy_1.CPU(new krajsy_1.ROM(result.bytes), new krajsy_1.RAM());
            updateDisplay();
        }
        catch (e) {
            output.value = e;
        }
    };
    run.onclick = () => {
        run.innerText = inv == null ? "Stop" : "Run";
        if (inv == null) {
            inv = setInterval(() => {
                step.onclick(null);
            }, 100);
        }
        else {
            clearInterval(inv);
            inv = null;
        }
    };
    share.onclick = () => {
        const url = window.location;
        const base = url.toString().replace(window.location.search, "");
        const link = base + '?share=' + btoa(input.value);
        navigator.clipboard.writeText(link).then(() => {
            alert("Copied link to clipboard!");
        }, (err) => {
            alert("Error copying link to clipboard: " + err);
        });
    };
    input.addEventListener('keydown', function (e) {
        if (e.key == 'Tab') {
            e.preventDefault();
            var start = this.selectionStart;
            var end = this.selectionEnd;
            // set textarea value to: text before caret + tab + text after caret
            this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
            // put caret at right position again
            this.selectionStart = this.selectionEnd = start + 1;
        }
    });
    const updateDisplay = () => {
        var _a;
        ram.value = (_a = cpu === null || cpu === void 0 ? void 0 : cpu.ram) === null || _a === void 0 ? void 0 : _a.dump();
        regA.value = `0x${cpu === null || cpu === void 0 ? void 0 : cpu.A.toString(16).padStart(2, '0')}\t0b${cpu === null || cpu === void 0 ? void 0 : cpu.A.toString(2).padStart(8, '0')}\t${cpu === null || cpu === void 0 ? void 0 : cpu.A}`;
        regB.value = `0x${cpu === null || cpu === void 0 ? void 0 : cpu.B.toString(16).padStart(2, '0')}\t0b${cpu === null || cpu === void 0 ? void 0 : cpu.B.toString(2).padStart(8, '0')}\t${cpu === null || cpu === void 0 ? void 0 : cpu.B}`;
        regPC.value = `0x${cpu === null || cpu === void 0 ? void 0 : cpu.PC.toString(16).padStart(2, '0')}\t0b${cpu === null || cpu === void 0 ? void 0 : cpu.PC.toString(2).padStart(8, '0')}\t${cpu === null || cpu === void 0 ? void 0 : cpu.PC}`;
        output.value = result.layout.split('\n').map((x) => parseInt(x) == cpu.PC ? `>${x}` : ' ' + x).join('\n').replace(/\n$/g, '\n\n');
    };
    compile.onclick(null);
};

})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxHQUFHLGFBQUgsR0FBRyx1QkFBSCxHQUFHLENBQUUsRUFBRSxFQUFFLENBQUM7UUFFbEgsTUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDcEksQ0FBQztJQUVELE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEIsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL0tyYWpzeUFyY2gvLi9zcmMva3JhanN5LnRzIiwid2VicGFjazovL0tyYWpzeUFyY2gvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vS3JhanN5QXJjaC8uL3NyYy9hcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgRW1wdHkgPSAobGVuZ3RoOiBudW1iZXIpID0+IEFycmF5LmZyb20oQXJyYXkobGVuZ3RoKS5rZXlzKCkpLm1hcCgoKSA9PiAwKTtcblxuZXhwb3J0IGNsYXNzIFJPTSB7XG4gIHByb3RlY3RlZCBkYXRhOiBBcnJheTxudW1iZXI+XG5cbiAgY29uc3RydWN0b3IoZGF0YTogQXJyYXk8bnVtYmVyPiA9IG51bGwpIHtcbiAgICB0aGlzLmRhdGEgPSBFbXB0eSgyNTYpO1xuICAgIHRoaXMubWVtY3B5KGRhdGEsIDAsIGRhdGE/Lmxlbmd0aCA/PyAwKTtcbiAgfVxuXG4gIG1lbWNweShzcmM6IEFycmF5PG51bWJlcj4sIGRlc3Q6IG51bWJlciwgc2l6ZTogbnVtYmVyKSB7XG4gICAgZm9yIChsZXQgaSA9IGRlc3Q7IGkgPCBkZXN0ICsgc2l6ZTsgKytpKVxuICAgICAgdGhpcy5kYXRhW2ldID0gc3JjW2ldXG4gIH1cblxuICBnZXQoaWR4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmIChpZHggPCAwIHx8IGlkeCA+IDI1NSlcbiAgICAgIHRocm93IFwiUHJvZ3JhbSB0cmllZCB0byBhY2Nlc3MgbWVtb3J5IG91dCBvZiBib3VuZHMhXCI7XG4gICAgcmV0dXJuIHRoaXMuZGF0YVtpZHhdO1xuICB9XG5cbiAgZHVtcCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmRhdGEubWFwKCh4LCBpKSA9PiB4LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpICsgKCgoaSArIDEpICUgMTYpID8gJyAnIDogJ1xcbicpKS5qb2luKCcnKVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSQU0gZXh0ZW5kcyBST00ge1xuICBzZXQoaWR4OiBudW1iZXIsIGRhdGE6IG51bWJlcik6IHZvaWQge1xuICAgIGlmIChpZHggPCAwIHx8IGlkeCA+IDI1NSlcbiAgICAgIHRocm93IFwiUHJvZ3JhbSB0cmllZCB0byBhY2Nlc3MgbWVtb3J5IG91dCBvZiBib3VuZHMhXCI7XG4gICAgdGhpcy5kYXRhW2lkeF0gPSBkYXRhO1xuICB9XG5cbiAgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5kYXRhID0gRW1wdHkoMjU2KTtcbiAgfVxufVxuXG5leHBvcnQgZW51bSBSZWdpc3RlcnMge1xuICBBID0gMCxcbiAgQiA9IDEsXG4gIFBDID0gMixcbn1cblxuZXhwb3J0IGVudW0gSW5zdHJ1Y3Rpb25zIHtcbiAgSU5WID0gMGIwMDAwMCxcbiAgQUREID0gMGIwMDAwMSxcbiAgU1VCID0gMGIwMDAxMCxcbiAgT1IgPSAwYjAwMDExLFxuICBBTkQgPSAwYjAwMTAwLFxuICBYT1IgPSAwYjAwMTAxLFxuICBHRVQgPSAwYjAwMTEwLFxuICBTRVQgPSAwYjAwMTExLFxuICBMRCA9IDBiMDEwMDAsXG4gIFNXUCA9IDBiMDEwMDEsXG4gIC8vIC4uLlxuICBKWiA9IDBiMTExMDAsXG4gIEpOWiA9IDBiMTExMDEsXG4gIEpHID0gMGIxMTExMCxcbiAgSkwgPSAwYjExMTExLFxufVxuXG5leHBvcnQgY2xhc3MgQ1BVIHtcbiAgcHVibGljIHJvbTogUk9NO1xuICBwdWJsaWMgcmFtOiBSQU07XG5cbiAgcHVibGljIEE6IG51bWJlcjtcbiAgcHVibGljIEI6IG51bWJlcjtcbiAgcHVibGljIFBDOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3Iocm9tOiBST00sIHJhbTogUkFNKSB7XG4gICAgdGhpcy5yb20gPSByb207XG4gICAgdGhpcy5yYW0gPSByYW07XG4gICAgdGhpcy5BID0gdGhpcy5CID0gdGhpcy5QQyA9IDA7XG4gIH1cblxuICBzdGVwKCk6IHZvaWQge1xuICAgIC8vIFJlYWQgaW5zdHJ1Y3Rpb24gY29kZSBmcm9tIHJvbVxuICAgIGNvbnN0IG9wY29kZSA9IHRoaXMucm9tLmdldCh0aGlzLlBDKTtcblxuICAgIGNvbnN0IG9wMCA9IChvcGNvZGUgPj4gNykgJiAwYjE7ICAvLyBTZWxlY3Rpb24gYmV0d2VlbiBBL0IgcmVnaXN0ZXIgYXMgWFxuICAgIGNvbnN0IG9wMSA9IChvcGNvZGUgPj4gNSkgJiAwYjExOyAvLyBTZWxlY3Rpb24gYmV0d2VlbiBBL0IvUkFNL1JPTSBhcyBZXG4gICAgY29uc3QgaW5zID0gb3Bjb2RlICYgMGIxMTExMTsgICAgIC8vIEluc3RydWN0aW9uIHRvIGV4ZWN1dGUgYmV0d2VlbiBYIGFuZCBZXG5cbiAgICBjb25zdCBYID0gb3AwID8gdGhpcy5CIDogdGhpcy5BO1xuXG4gICAgY29uc3QgWSA9IG9wMSA9PSAwYjAwID8gdGhpcy5BIDpcbiAgICAgICAgICAgICAgb3AxID09IDBiMDEgPyB0aGlzLkIgOlxuICAgICAgICAgICAgICBvcDEgPT0gMGIxMCA/IHRoaXMucmFtLmdldCh0aGlzLnJvbS5nZXQoKyt0aGlzLlBDKSkgOlxuICAgICAgICAgICAgICBvcDEgPT0gMGIxMSA/IHRoaXMucm9tLmdldCgrK3RoaXMuUEMpIDogMDtcblxuICAgIGxldCBYMCA9IG51bGw7XG4gICAgbGV0IFkwID0gbnVsbDtcblxuICAgIHN3aXRjaCAoaW5zKSB7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5JTlY6IFgwID0gflg7IGJyZWFrO1xuICAgICAgY2FzZSBJbnN0cnVjdGlvbnMuQUREOiBYMCA9IFggKyBZOyBicmVhaztcbiAgICAgIGNhc2UgSW5zdHJ1Y3Rpb25zLlNVQjogWDAgPSBYIC0gWTsgYnJlYWs7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5PUjogIFgwID0gWCB8IFk7IGJyZWFrO1xuICAgICAgY2FzZSBJbnN0cnVjdGlvbnMuQU5EOiBYMCA9IFggJiBZOyBicmVhaztcbiAgICAgIGNhc2UgSW5zdHJ1Y3Rpb25zLlhPUjogWDAgPSBYIF4gWTsgYnJlYWs7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5HRVQ6IFgwID0gdGhpcy5yYW0uZ2V0KFkpOyBicmVhaztcbiAgICAgIGNhc2UgSW5zdHJ1Y3Rpb25zLlNFVDogdGhpcy5yYW0uc2V0KFksIFgpOyBicmVhaztcbiAgICAgIGNhc2UgSW5zdHJ1Y3Rpb25zLkxEOiAgWDAgPSBZOyBicmVhaztcbiAgICAgIGNhc2UgSW5zdHJ1Y3Rpb25zLlNXUDoge1xuICAgICAgICBbdGhpcy5BLCB0aGlzLkJdID0gW3RoaXMuQiwgdGhpcy5BXTtcbiAgICAgIH0gYnJlYWs7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5KWjoge1xuICAgICAgICBpZiAoWCA9PSAwKSB0aGlzLlBDID0gWSAtIDE7XG4gICAgICB9IGJyZWFrO1xuICAgICAgY2FzZSBJbnN0cnVjdGlvbnMuSk5aOiB7XG4gICAgICAgIGlmIChYICE9IDApIHRoaXMuUEMgPSBZIC0gMTtcbiAgICAgIH0gYnJlYWs7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5KRzoge1xuICAgICAgICBpZiAoWCA+IDApIHRoaXMuUEMgPSBZIC0gMTtcbiAgICAgIH0gYnJlYWs7XG4gICAgICBjYXNlIEluc3RydWN0aW9ucy5KTDoge1xuICAgICAgICBpZiAoWCA8IDApIHRoaXMuUEMgPSBZIC0gMTtcbiAgICAgIH0gYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHJlZ2lzdGVycywgbWFrZSBzdXJlIHRoZXkgYXJlIG5vdCBvdmVyZmxvd2luZ1xuICAgIHRoaXMuUEMgPSAodGhpcy5QQyArIDEpICYgMHhGRjtcbiAgICB0aGlzLkEgPSAoKG9wMCA/IFkwIDogWDApID8/IHRoaXMuQSkgJiAweEZGO1xuICAgIHRoaXMuQiA9ICgob3AwID8gWDAgOiBZMCkgPz8gdGhpcy5CKSAmIDB4RkY7XG4gIH1cblxuICByZXNldCgpOiB2b2lkIHtcbiAgICB0aGlzLnJhbS5yZXNldCgpO1xuICAgIHRoaXMuQSA9IHRoaXMuQiA9IHRoaXMuUEMgPSAwO1xuICB9XG5cbiAgZHVtcCgpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhgQTogJHt0aGlzLkEudG9TdHJpbmcoMTYpfWApO1xuICAgIGNvbnNvbGUubG9nKGBCOiAke3RoaXMuQi50b1N0cmluZygxNil9YCk7XG4gICAgY29uc29sZS5sb2coYFBDOiAke3RoaXMuUEMudG9TdHJpbmcoMTYpfWApO1xuICAgIGNvbnNvbGUubG9nKGBSQU06XFxuJHt0aGlzLnJhbS5kdW1wKCl9YCk7XG4gICAgY29uc29sZS5sb2coYFJPTTpcXG4ke3RoaXMucm9tLmR1bXAoKX1gKTtcbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzc2VtYmxlUmVzdWx0IHtcbiAgYnl0ZXM6IG51bWJlcltdLFxuICBsYXlvdXQ6IHN0cmluZ1xufVxuXG5leHBvcnQgY29uc3QgYXNzZW1ibGUgPSAoY29kZTogc3RyaW5nKTogQXNzZW1ibGVSZXN1bHQgPT4ge1xuICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBjb2RlLnNwbGl0KCdcXG4nKS5maWx0ZXIoKHgpID0+IHgudHJpbSgpLmxlbmd0aCAhPSAwICYmICF4LnN0YXJ0c1dpdGgoJzsnKSk7XG4gIGNvbnN0IGxhYmVsczoge1tpZDogc3RyaW5nXTogbnVtYmVyO30gPSB7fTtcblxuICBjb25zdCBieXRlczogbnVtYmVyW10gPSBbXTtcbiAgbGV0IGxheW91dCA9IFwiXCI7XG5cblxuICBjb25zdCBmZXRjaE9wZXJhbnQgPSAodG9rZW46IHN0cmluZyk6IFtudW1iZXIsIG51bWJlcl0gPT4ge1xuICAgIGlmICh0b2tlbiA9PSB1bmRlZmluZWQpIFxuICAgICAgcmV0dXJuIFsgMCwgLTEgXTtcblxuICAgIHN3aXRjaCh0b2tlblswXSkge1xuICAgICAgY2FzZSAnQSc6XG4gICAgICAgIHJldHVybiBbIDBiMDAsIC0xIF1cbiAgICAgIGNhc2UgJ0InOlxuICAgICAgICByZXR1cm4gWyAwYjAxLCAtMSBdXG4gICAgICBjYXNlICcqJzpcbiAgICAgICAgcmV0dXJuIFsgMGIxMCwgcGFyc2VJbnQodG9rZW4uc3Vic3RyaW5nKDEpLCAxNikgXVxuICAgICAgY2FzZSAnIyc6XG4gICAgICAgIHJldHVybiBbIDBiMTEsIHBhcnNlSW50KHRva2VuLnN1YnN0cmluZygxKSwgMTYpIF1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmIChsYWJlbHNbdG9rZW5dICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiBbIDBiMTEsIGxhYmVsc1t0b2tlbl0gXTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBcIkludmFsaWQgb3BlcmFudCB2YWx1ZSFcIjtcbiAgICB9XG4gIH1cblxuICBsaW5lcy5mb3JFYWNoKChsaW5lOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB0b2tlbnMgPSBsaW5lLnNwbGl0KCc7JylbMF0uc3BsaXQoJyAnKTtcbiAgICBjb25zdCBvcGNvZGUgPSB0b2tlbnMuc2hpZnQoKS50b1VwcGVyQ2FzZSgpO1xuICAgIGNvbnN0IG9wZXJhbnRzID0gdG9rZW5zLmpvaW4oJycpLnRvVXBwZXJDYXNlKCkuc3BsaXQoJywnKS5maWx0ZXIoeCA9PiB4LnRyaW0oKS5sZW5ndGggPiAwKTtcblxuICAgIGlmIChvcGNvZGUuZW5kc1dpdGgoJzonKSkge1xuICAgICAgbGFiZWxzW29wY29kZS5zdWJzdHJpbmcoMCwgb3Bjb2RlLmxlbmd0aC0xKV0gPSBieXRlcy5sZW5ndGg7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaW5zOiBudW1iZXIgPSBJbnN0cnVjdGlvbnNbb3Bjb2RlXTtcbiAgICBpZiAoaW5zID09IHVuZGVmaW5lZClcbiAgICAgIHRocm93IFwiT3Bjb2RlIGRvZXMgbm90IGV4aXN0IVwiO1xuXG4gICAgY29uc3QgeCA9IG9wZXJhbnRzLmxlbmd0aCA+IDAgJiYgZmV0Y2hPcGVyYW50KG9wZXJhbnRzWzBdKTtcbiAgICBjb25zdCB5ID0gb3BlcmFudHMubGVuZ3RoID4gMSAmJiBmZXRjaE9wZXJhbnQob3BlcmFudHNbMV0pO1xuXG4gICAgaWYgKHhbMF0gPiAwYjAxKVxuICAgICAgdGhyb3cgXCJGaXJzdCBvcGVyYW50IGNhbiBvbmx5IGJlIEEgb3IgQiFcIjtcblxuICAgIGNvbnN0IGNvZGUgPSAoeFswXSA8PCA3KSB8ICh5WzBdIDw8IDUpIHwgaW5zO1xuICAgIGxldCByb3cgPSBjb2RlLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpICsgJyAnO1xuICAgIGxldCBhZGRyID0gYnl0ZXMubGVuZ3RoO1xuXG4gICAgYnl0ZXMucHVzaChjb2RlKTtcblxuICAgIGlmICh5WzFdID49IDApIHtcbiAgICAgIGJ5dGVzLnB1c2goeVsxXSk7XG4gICAgICByb3cgKz0geVsxXS50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSArICcgJztcbiAgICB9XG5cbiAgICBsYXlvdXQgKz0gKGFkZHIudG9TdHJpbmcoKSArICc6JykucGFkU3RhcnQoNCwgJzAnKS5wYWRFbmQoOCwgJyAnKSArIHJvdy5wYWRFbmQoMTAsICcgJykgKyBgOyAke2xpbmV9XFxuYDtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBieXRlczogYnl0ZXMsXG4gICAgbGF5b3V0OiBsYXlvdXQsXG4gIH07XG59XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiaW1wb3J0IHsgUk9NLCBSQU0sIENQVSwgYXNzZW1ibGUsIEFzc2VtYmxlUmVzdWx0IH0gZnJvbSAnLi9rcmFqc3knXG5cblxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImlucHV0XCIpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIGNvbnN0IG91dHB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3V0cHV0XCIpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIGNvbnN0IHJhbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmFtXCIpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gIGNvbnN0IHJlZ0EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlZ0FcIikgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcbiAgY29uc3QgcmVnQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVnQlwiKSBhcyBIVE1MVGV4dEFyZWFFbGVtZW50O1xuICBjb25zdCByZWdQQyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVnUENcIikgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcblxuICBjb25zdCByZXNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzZXRcIik7XG4gIGNvbnN0IHN0ZXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0ZXBcIik7XG4gIGNvbnN0IGNvbXBpbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbXBpbGVcIik7XG4gIGNvbnN0IHJ1biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicnVuXCIpO1xuICBjb25zdCBzaGFyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2hhcmVcIik7XG5cbiAgbGV0IHJlc3VsdDogQXNzZW1ibGVSZXN1bHQgPSBudWxsO1xuICBsZXQgY3B1OiBDUFUgPSBudWxsO1xuICBsZXQgaW52ID0gbnVsbDtcblxuICBpZiAod2luZG93LmxvY2F0aW9uLnNlYXJjaC5sZW5ndGggPiAwKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlucHV0LnZhbHVlID0gYXRvYih3aW5kb3cubG9jYXRpb24uc2VhcmNoLnJlcGxhY2UoXCI/c2hhcmU9XCIsIFwiXCIpKTtcbiAgICB9IGNhdGNoKGUpIHt9XG4gIH1cblxuICByZXNldC5vbmNsaWNrID0gKCkgPT4ge1xuICAgIGNwdT8ucmVzZXQoKTtcbiAgICB1cGRhdGVEaXNwbGF5KCk7XG4gIH1cblxuICBzdGVwLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgaWYgKHJlc3VsdC5sYXlvdXQuc3BsaXQoJ1xcbicpLmZpbHRlcigoeCkgPT4gcGFyc2VJbnQoeCkgPT0gY3B1LlBDKS5sZW5ndGggPT0gMCkge1xuICAgICAgaWYgKGludiAhPSBudWxsKVxuICAgICAgICBydW4ub25jbGljayhudWxsKTtcbiAgICAgIGFsZXJ0KFwiUEMgaGl0IGVuZCBvZiBST01cIik7XG4gICAgfVxuXG4gICAgY3B1Py5zdGVwKCk7XG4gICAgdXBkYXRlRGlzcGxheSgpO1xuICB9XG5cbiAgY29tcGlsZS5vbmNsaWNrID0gKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBhc3NlbWJsZShpbnB1dC52YWx1ZSk7XG4gICAgICBvdXRwdXQuaW5uZXJIVE1MID0gcmVzdWx0LmxheW91dDtcbiAgICAgIGNwdSA9IG5ldyBDUFUobmV3IFJPTShyZXN1bHQuYnl0ZXMpLCBuZXcgUkFNKCkpO1xuICAgICAgdXBkYXRlRGlzcGxheSgpO1xuICAgIH0gY2F0Y2goZSkge1xuICAgICAgb3V0cHV0LnZhbHVlID0gZTtcbiAgICB9XG4gIH1cblxuICBydW4ub25jbGljayA9ICgpID0+IHtcbiAgICBydW4uaW5uZXJUZXh0ID0gaW52ID09IG51bGwgPyBcIlN0b3BcIiA6IFwiUnVuXCI7XG4gICAgaWYgKGludiA9PSBudWxsKSB7XG4gICAgICBpbnYgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHN0ZXAub25jbGljayhudWxsKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwoaW52KTtcbiAgICAgIGludiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgc2hhcmUub25jbGljayA9ICgpID0+IHtcbiAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb247XG4gICAgY29uc3QgYmFzZSA9IHVybC50b1N0cmluZygpLnJlcGxhY2Uod2luZG93LmxvY2F0aW9uLnNlYXJjaCwgXCJcIik7XG4gICAgY29uc3QgbGluayA9IGJhc2UgKyAnP3NoYXJlPScgKyBidG9hKGlucHV0LnZhbHVlKTtcblxuICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGxpbmspLnRoZW4oKCkgPT4ge1xuICAgICAgYWxlcnQoXCJDb3BpZWQgbGluayB0byBjbGlwYm9hcmQhXCIpO1xuICAgIH0sIChlcnIpID0+IHtcbiAgICAgIGFsZXJ0KFwiRXJyb3IgY29weWluZyBsaW5rIHRvIGNsaXBib2FyZDogXCIgKyBlcnIpO1xuICAgIH0pO1xuICB9XG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS5rZXkgPT0gJ1RhYicpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgIHZhciBlbmQgPSB0aGlzLnNlbGVjdGlvbkVuZDtcblxuICAgICAgLy8gc2V0IHRleHRhcmVhIHZhbHVlIHRvOiB0ZXh0IGJlZm9yZSBjYXJldCArIHRhYiArIHRleHQgYWZ0ZXIgY2FyZXRcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cmluZygwLCBzdGFydCkgKyBcIlxcdFwiICsgdGhpcy52YWx1ZS5zdWJzdHJpbmcoZW5kKTtcblxuICAgICAgLy8gcHV0IGNhcmV0IGF0IHJpZ2h0IHBvc2l0aW9uIGFnYWluXG4gICAgICB0aGlzLnNlbGVjdGlvblN0YXJ0ID0gdGhpcy5zZWxlY3Rpb25FbmQgPSBzdGFydCArIDE7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCB1cGRhdGVEaXNwbGF5ID0gKCkgPT4ge1xuICAgIHJhbS52YWx1ZSA9IGNwdT8ucmFtPy5kdW1wKCk7XG4gICAgcmVnQS52YWx1ZSA9IGAweCR7Y3B1Py5BLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpfVxcdDBiJHtjcHU/LkEudG9TdHJpbmcoMikucGFkU3RhcnQoOCwgJzAnKX1cXHQke2NwdT8uQX1gO1xuICAgIHJlZ0IudmFsdWUgPSBgMHgke2NwdT8uQi50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKX1cXHQwYiR7Y3B1Py5CLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDgsICcwJyl9XFx0JHtjcHU/LkJ9YDtcbiAgICByZWdQQy52YWx1ZSA9IGAweCR7Y3B1Py5QQy50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKX1cXHQwYiR7Y3B1Py5QQy50b1N0cmluZygyKS5wYWRTdGFydCg4LCAnMCcpfVxcdCR7Y3B1Py5QQ31gO1xuXG4gICAgb3V0cHV0LnZhbHVlID0gcmVzdWx0LmxheW91dC5zcGxpdCgnXFxuJykubWFwKCh4KSA9PiBwYXJzZUludCh4KSA9PSBjcHUuUEMgPyBgPiR7eH1gIDogJyAnICsgeCkuam9pbignXFxuJykucmVwbGFjZSgvXFxuJC9nLCAnXFxuXFxuJyk7XG4gIH1cblxuICBjb21waWxlLm9uY2xpY2sobnVsbCk7XG59XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=